<!-- build time:Sun May 05 2019 18:42:24 GMT+0800 (CST) --><!DOCTYPE html><html lang="zh-Hans" class="loading"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no"><title>手动创建Mesh及相关理论知识 - 鸵鸟工作室</title><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="google" content="notranslate"><meta name="keywords" content="Fechin,"><meta name="description" content="鸵鸟工作室,创建Mesh这篇教程说的非常清楚.123456789101112131415161718[RequireComponent(typeof(MeshFilter), typeof(MeshRender,"><meta name="author" content="鸵鸟工作室"><link rel="alternative" href="atom.xml" title="鸵鸟工作室" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><link rel="stylesheet" href="/css/diaspora.css"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-8691406134231910",enable_page_level_ads:!0})</script><script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js"></script></head></html><body class="loading"><span id="config-title" style="display:none">鸵鸟工作室</span><div id="loader"></div><div id="single"><div id="top" style="display:block"><div class="bar" style="width:0"></div><a class="icon-home image-icon" href="javascript:;" data-url="http://鸵鸟工作室.fun"></a><div title="播放/暂停" class="icon-play"></div><h3 class="subtitle">手动创建Mesh及相关理论知识</h3><div class="social"><div><div class="share"><a title="获取二维码" class="icon-scan" href="javascript:;"></a></div><div id="qr"></div></div></div><div class="scrollbar"></div></div><div class="section"><div class="article"><div class="main"><h1 class="title">手动创建Mesh及相关理论知识</h1><div class="stuff"><span>十二月 03, 2017</span><ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Mesh/">Mesh</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Unity/">Unity</a></li></ul></div><div class="content markdown"><h2 id="创建Mesh"><a href="#创建Mesh" class="headerlink" title="创建Mesh"></a>创建Mesh</h2><p>这篇<a href="http://catlikecoding.com/unity/tutorials/procedural-grid/" target="_blank" rel="noopener">教程</a>说的非常清楚.</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[RequireComponent(<span class="keyword">typeof</span>(MeshFilter), <span class="keyword">typeof</span>(MeshRenderer))]</span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeMeshTriangle</span> : <span class="title">MonoBehaviour</span></span></span><br><span class="line"><span class="class">  </span>&#123;</span><br><span class="line">      <span class="keyword">public</span> Transform p0;</span><br><span class="line">      <span class="keyword">public</span> Transform p1;</span><br><span class="line">      <span class="keyword">public</span> Transform p2;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">void</span> Generate()</span><br><span class="line">      &#123;</span><br><span class="line">          GetComponent&lt;MeshFilter&gt;().mesh = mMesh = <span class="keyword">new</span> Mesh();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">var</span> vertices = <span class="keyword">new</span>[] &#123;p0.localPosition, p1.localPosition, p2.localPosition&#125;;</span><br><span class="line">          <span class="keyword">var</span> triangles = <span class="keyword">new</span>[] &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">         </span><br><span class="line">          mMesh.vertices = vertices;</span><br><span class="line">          mMesh.triangles = triangles;            </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>构建一个Mesh只需要两部分,一个是顶点坐标(vertices),一个是由顶点坐标构成的三角形(triangles)</p><p><img src="/media/15123415221848.png" alt="15123415221848"></p><p>需要注意就是其正反面,顺时针(clockwise)正面,逆时针(Counter-clockwise)反面</p><h2 id="UV映射及Normal映射"><a href="#UV映射及Normal映射" class="headerlink" title="UV映射及Normal映射"></a>UV映射及Normal映射</h2><p>教程前半部分很好理解,比较让我困惑的是后半部分关于NormalMap中TBN(Tangent,Bitangent,Normal)的阐述.</p><h3 id="NormalMap的含义"><a href="#NormalMap的含义" class="headerlink" title="NormalMap的含义"></a>NormalMap的含义</h3><p>首先要说的是什么是NormalMap,<a href="https://docs.unity3d.com/Manual/StandardShaderMaterialParameterNormalMap.html" target="_blank" rel="noopener">官网</a>解说的非常清楚了.</p><p>普通Mesh<br><img src="/media/QQ20171204-065816.jpg" alt="QQ20171204-065816"></p><p>加入NormalMap<br><img src="/media/QQ20171204-065917.jpg" alt="QQ20171204-065917"></p><blockquote><p>each pixel in the texture of the normal map (called a texel) represents a deviation in surface normal direction away from the “true” surface normal of the flat (or smooth interpolated) polygon.</p></blockquote><h3 id="Normal映射及TBN"><a href="#Normal映射及TBN" class="headerlink" title="Normal映射及TBN"></a>Normal映射及TBN</h3><p>最让我不理解的是教程中关于切线(tangents)的解释. 他直接说到</p><blockquote><p>As we have a flat surface, all tangents simply point in the same direction,which is to the right.</p></blockquote><p>然后直接给出代码</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vector4 tangent = <span class="built_in">new</span> Vector4(<span class="number">1f</span>, <span class="number">0f</span>, <span class="number">0f</span>, <span class="number">-1f</span>);</span><br></pre></td></tr></table></figure><p>让人不明所以,不知道他这个为啥直接就point了right.</p><p>不过搞清楚这点要有几个预备知识.</p><p>首先是UV映射. 可以看Y2B上的<a href="https://www.youtube.com/watch?v=YPX33hoXGa8" target="_blank" rel="noopener">这个视频</a>,</p><p><img src="/media/QQ20171204-071033.jpg" alt="QQ20171204-071033"></p><p>没有涉及到太底层的数学推导,感性的认知UVMaping就是</p><blockquote><p><strong>给定UV中的一个三角形U(三个点分别为U1,U2,U3) =&gt; 通过某种方法映射到 =&gt; 模型中的三角形P(P1,P2,P3)</strong></p></blockquote><p>这个<a href="https://www.youtube.com/watch?v=KQYxxndNNlA" target="_blank" rel="noopener">视频</a>有开了一个头,但是也没具体讲. 不过具体的映射方法,应该是和线性插值有关,没有细研究</p><p><img src="/media/QQ20171203-190005.jpg" alt="QQ20171203-190005"></p><p>可以用<code>线性插值</code>,<code>双线性插值</code>,<code>Trilinear</code>,<code>Bilinear</code> 作为Key搜搜看.</p><p>不过重点是下面这张图</p><p><img src="/media/QQ20171203-182318.jpg" alt="QQ20171203-182318"></p><p>个人理解,不一定对. 无论UV映射也好,Normal映射也好. 都需要将贴图首先旋转到与需要映射的三角形相同的一个角度. 也就是对UV图,Normal图的坐标系有旋转</p><p>如图,左边的P’三角形 和右边的P三角形 就不在一个平面. 相应的做UV时候,其坐标轴也发生的旋转.</p><p>而这个旋转的角度 从某种角度来说就是TBN</p><p>原因可以看<a href="http://www.opengl-tutorial.org/cn/intermediate-tutorials/tutorial-13-normal-mapping/" target="_blank" rel="noopener">OpenGL的教程</a></p><p>选定Normal后<br><img src="/media/15123440805547.png" alt="15123440805547"></p><p>垂直与该Normal的向量有很多</p><p><img src="/media/15123441065379.png" alt="15123441065379"></p><p>为了方便计算,所以选择和和纹理空间对齐方向<br><img src="/media/15123441425223.png" alt="15123441425223"></p><p>结合我自己画的那个图,也就是说 纹理空间的方向就是P’三角形所在的那个坐标系. 这个坐标系也就是UV的坐标系,也是NormalMap的切线(Tangent)和副切线(Bitangent)方向.</p><p>至于这个坐标系的求出</p><blockquote><p>给定UV中的一个三角形U(三个点分别为U1,U2,U3) =&gt; 通过某种方法映射到 =&gt; 模型中的三角形P(P1,P2,P3)</p></blockquote><p>我是理解为,给出了UV上的三个点,然后给出模型上的三个点,Unity已经就帮我们算出来了.(通过数学推导肯定是可以算出来的,我没有细研究).</p><p>所以我理解的设置NormalMap流程应该是,设定好UV,然后给定Normal方向,最后通过<a href="https://docs.unity3d.com/ScriptReference/Mesh.html" target="_blank" rel="noopener"><code>Mesh.RecalculateTangents</code></a>重新计算出TB两个方向,而不是反过来直接给定了<code>Vector4 tangent = new Vector4(1f, 0f, 0f, -1f);</code></p><p>不过直接给定Tangent角度现在想想似乎也可以理解. 教程中的Mesh角度和我自己画的图中右侧的正方形一样,此时UV图面没有任何旋转,(1,0,0)也就是其x轴方向.</p><p>完整代码:</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[RequireComponent(typeof(MeshFilter), typeof(MeshRenderer))]</span><br><span class="line">   <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeMeshTriangle</span> : <span class="title">MonoBehaviour</span></span></span><br><span class="line"><span class="class">   </span>&#123;</span><br><span class="line">       <span class="keyword">public</span> Transform p0;</span><br><span class="line">       <span class="keyword">public</span> Transform p1;</span><br><span class="line">       <span class="keyword">public</span> Transform p2;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> Mesh mMesh;</span><br><span class="line">       <span class="keyword">private</span> Vector3[] mVertices;</span><br><span class="line">       <span class="keyword">private</span> Vector3[] mNormals;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> void Update()</span><br><span class="line">       &#123;</span><br><span class="line">           Generate();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">private</span> void Generate()</span><br><span class="line">       &#123;</span><br><span class="line">           GetComponent&lt;MeshFilter&gt;().mesh = mMesh = <span class="keyword">new</span> <span class="type">Mesh</span>();</span><br><span class="line"></span><br><span class="line">           <span class="keyword">var</span> normal = <span class="keyword">new</span> <span class="type">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">           mVertices = <span class="keyword">new</span><span class="type"></span>[] &#123;p0.localPosition, p1.localPosition, p2.localPosition&#125;;</span><br><span class="line">           mNormals = <span class="keyword">new</span><span class="type"></span>[] &#123;normal, normal, normal&#125;;</span><br><span class="line">           <span class="keyword">var</span> triangles = <span class="keyword">new</span><span class="type"></span>[] &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line"></span><br><span class="line">           Vector2[] uv = <span class="keyword">new</span> <span class="type">Vector2</span>[<span class="number">3</span>];</span><br><span class="line">           uv[<span class="number">0</span>] = <span class="keyword">new</span> <span class="type">Vector2</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">           uv[<span class="number">1</span>] = <span class="keyword">new</span> <span class="type">Vector2</span>(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">           uv[<span class="number">2</span>] = <span class="keyword">new</span> <span class="type">Vector2</span>(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">           mMesh.vertices = mVertices;</span><br><span class="line">           mMesh.triangles = triangles;</span><br><span class="line">           mMesh.uv = uv;</span><br><span class="line">           mMesh.normals = mNormals;</span><br><span class="line"></span><br><span class="line">           mMesh.RecalculateTangents();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]--><audio id="audio" loop preload="auto" controls data-autoplay="false"><source type="audio/mpeg" src=""></audio><ul id="audio-list" style="display:none"><li title="0" data-url="http://link.hhtjim.com/163/5146554.mp3"></li><li title="1" data-url="http://link.hhtjim.com/qq/001faIUs4M2zna.mp3"></li></ul></div><div id="gitalk-container" class="comment link" data-ae="false" data-ci="" data-cs="" data-r="" data-o="" data-a="" data-d="false">查看评论</div></div></div></div></div></body><script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script><script src="/js/plugin.js"></script><script src="/js/diaspora.js"></script><link rel="stylesheet" href="/photoswipe/photoswipe.css"><link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css"><script src="/photoswipe/photoswipe.min.js"></script><script src="/photoswipe/photoswipe-ui-default.min.js"></script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><!-- rebuild by neat -->